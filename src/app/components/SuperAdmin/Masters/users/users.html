<div class="flex flex-wrap w-full h-full">
  <div *ngIf="roleId === 1" class="w-full">
    <main class="flex-1 transition-all duration-300 w-full h-full">
      <div class="w-full h-full flex gap-4">
        <!-- Form on the left -->
        <div class="bg-white rounded-lg shadow-md p-6 w-3/4 h-full">
          <div class="mb-4 flex gap-4">
            <label class="inline-flex items-center">
              <input
                type="radio"
                name="formType"
                value="user"
                [(ngModel)]="selectedForm"
                class="form-radio text-blue-600"
              />
              <span class="ml-2">User</span>
            </label>
            <label class="inline-flex items-center">
              <input
                type="radio"
                name="formType"
                value="organization"
                [(ngModel)]="selectedForm"
                class="form-radio text-blue-600"
              />
              <span class="ml-2">Organization</span>
            </label>
          </div>
          <ng-container
            *ngIf="isLoadingUsers || isLoadingOrgs; else userFormTemplate"
          >
            <!-- Form Skeleton -->
            <div
              *ngFor="let f of [1,2,3]"
              class="animate-pulse h-8 bg-gray-200 rounded mb-4"
            ></div>
            <div class="flex justify-end gap-3 mt-4">
              <div class="animate-pulse h-8 w-20 bg-gray-300 rounded"></div>
              <div class="animate-pulse h-8 w-20 bg-blue-300 rounded"></div>
            </div>
          </ng-container>

          <ng-template #userFormTemplate>
            <form
              *ngIf="selectedForm === 'user'"
              (ngSubmit)="createOrModifyUser()"
              #userForm="ngForm"
              class="space-y-5 w-full h-full"
            >
              <div>
                <label
                  for="name"
                  class="block text-sm font-medium text-gray-700"
                  >Name</label
                >
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  [(ngModel)]="userFormData.name"
                  class="mt-1 block w-1/2 rounded-md border border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                />
              </div>

              <div>
                <label
                  for="email"
                  class="block text-sm font-medium text-gray-700"
                  >Email</label
                >
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  [(ngModel)]="userFormData.email"
                  class="mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                />
              </div>

              <div>
                <label
                  for="password"
                  class="block text-sm font-medium text-gray-700"
                  >Password</label
                >
                <input
                  type="password"
                  id="password"
                  name="password"
                  required
                  [(ngModel)]="userFormData.password"
                  class="mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                />
              </div>

              <div class="flex justify-end gap-3 pt-4">
                <button
                  type="button"
                  (click)="resetUserForm()"
                  class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  [disabled]="!userForm.form.valid"
                  class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition disabled:opacity-50"
                >
                  {{ selectedUserId ? 'Modify' : 'Create' }}
                </button>
              </div>
            </form>

            <!-- Organization Form -->
            <form
              *ngIf="selectedForm === 'organization'"
              (ngSubmit)="createOrModifyOrganization()"
              #orgForm="ngForm"
              class="space-y-5 w-full h-full"
            >
              <div>
                <label
                  for="orgName"
                  class="block text-sm font-medium text-gray-700"
                  >Organization Name</label
                >
                <input
                  type="text"
                  id="orgName"
                  name="orgName"
                  required
                  [(ngModel)]="orgFormData.name"
                  class="mt-1 block w-1/2 rounded-md border border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                />
              </div>

              <div>
                <label
                  for="orgEmail"
                  class="block text-sm font-medium text-gray-700"
                  >Email</label
                >
                <input
                  type="email"
                  id="orgEmail"
                  name="orgEmail"
                  required
                  [(ngModel)]="orgFormData.email"
                  class="mt-1 block w-full rounded-md border border-gray-300 p-2 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                />
              </div>

              <div class="flex justify-end gap-3 pt-4">
                <button
                  type="button"
                  (click)="resetOrgForm()"
                  class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400 transition"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  [disabled]="!orgForm.form.valid"
                  class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition disabled:opacity-50"
                >
                  {{ selectedOrgId ? 'Modify' : 'Create' }}
                </button>
              </div>
            </form>
          </ng-template>
        </div>

        <!-- Users list on the right -->
        <div
          class="bg-white rounded-lg shadow-md p-6 hidden md:flex md:flex-col md:w-1/4 md:h-full"
        >
          <!-- Users container -->
          <div class="flex-1 overflow-auto">
            <div>
              {{ selectedForm === 'user' ? 'List of Users' : 'List of
              Organizations' }}
              <span>
                ({{ selectedForm === 'user' ? filteredUsers.length :
                filteredOrgs.length }})
              </span>
            </div>

            <ng-container
              *ngIf="isLoadingUsers || isLoadingOrgs; else usersList"
            >
              <!-- Users Skeleton -->
              <div
                *ngFor="let s of [1,2,3,4,5]"
                class="animate-pulse p-2 my-1 bg-gray-200 rounded h-6"
              ></div>
            </ng-container>

            <ng-template #usersList>
              <div *ngIf="selectedForm === 'user'">
                <div
                  *ngIf="filteredUsers.length > 0; else noUsers"
                  class="pt-2"
                >
                  <ul>
                    <li
                      *ngFor="let user of filteredUsers"
                      class="cursor-pointer hover:bg-gray-200 p-1 rounded py-1 m-1"
                      [ngClass]="{ 'bg-blue-200': selectedUserId === user.id }"
                      (click)="selectUser(user)"
                    >
                      {{ user.name }}
                    </li>
                  </ul>
                </div>
              </div>
              <div *ngIf="selectedForm === 'organization'">
                <div *ngIf="filteredOrgs.length > 0; else noOrgs" class="pt-2">
                  <ul>
                    <li
                      *ngFor="let org of filteredOrgs"
                      class="cursor-pointer hover:bg-gray-200 p-1 rounded py-1 m-1"
                      [ngClass]="{ 'bg-green-200': selectedOrgId === org.id }"
                      (click)="selectOrg(org)"
                    >
                      {{ org.name }}
                    </li>
                  </ul>
                </div>
              </div>
            </ng-template>

            <ng-template #noUsers>No users found.</ng-template>
            <ng-template #noOrgs>No organizations found.</ng-template>
          </div>

          <!-- Search input at the bottom -->
          <div class="mt-2">
            <input
              type="text"
              [(ngModel)]="searchText"
              (ngModelChange)="onSearchChange()"
              placeholder="Search by name"
              class="w-full p-2 border border-gray-300 rounded"
            />
          </div>
        </div>
      </div>
    </main>
  </div>

  <div *ngIf="roleId === 2" class="w-full">
    <!-- Admin content -->
  </div>
</div>
