<div *ngIf="isLoading; else content">
  <div class="p-6 grid grid-cols-12 gap-6">
    <!-- Left panel: Filters -->
    <div class="col-span-3">
      <div class="bg-white rounded-lg shadow p-4 mb-4 animate-pulse">
        <div class="h-6 w-1/2 bg-gray-200 rounded mb-4"></div>

        <!-- Skeleton Selects -->
        <div class="space-y-4">
          <div class="h-10 bg-gray-200 rounded"></div>
          <div class="h-10 bg-gray-200 rounded"></div>
          <div class="h-10 bg-gray-200 rounded"></div>
          <div class="h-10 bg-gray-200 rounded"></div>
          <div class="h-10 bg-gray-200 rounded"></div>
          <div class="h-10 bg-gray-200 rounded"></div>
        </div>
      </div>
    </div>

    <!-- Right panel: Permissions -->
    <div class="col-span-9 grid grid-cols-1 gap-4">
      <div class="rounded-lg shadow bg-white animate-pulse">
        <!-- Header -->
        <div class="h-10 w-1/3 bg-gray-300 rounded-t-lg"></div>
        <div class="p-4 space-y-4">
          <!-- Main Permission skeletons -->
          <div class="space-y-2">
            <div class="h-4 w-1/4 bg-gray-200 rounded"></div>
            <div class="grid grid-cols-3 gap-2">
              <div class="h-6 bg-gray-200 rounded"></div>
              <div class="h-6 bg-gray-200 rounded"></div>
              <div class="h-6 bg-gray-200 rounded"></div>
            </div>
          </div>

          <!-- Sub Permissions skeleton -->
          <div class="pl-4 border-l-2 border-gray-200 mt-4 space-y-2">
            <div class="h-4 w-1/5 bg-gray-200 rounded"></div>
            <div class="grid grid-cols-3 gap-2">
              <div class="h-6 bg-gray-200 rounded"></div>
              <div class="h-6 bg-gray-200 rounded"></div>
              <div class="h-6 bg-gray-200 rounded"></div>
            </div>
          </div>

          <!-- Nested Permissions skeleton -->
          <div class="pl-8 border-l-2 border-gray-300 mt-4 space-y-2">
            <div class="h-4 w-1/6 bg-gray-200 rounded"></div>
            <div class="grid grid-cols-3 gap-2">
              <div class="h-6 bg-gray-200 rounded"></div>
              <div class="h-6 bg-gray-200 rounded"></div>
              <div class="h-6 bg-gray-200 rounded"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #content>
  <div class="p-6 grid grid-cols-12 gap-6">
    <!-- Left panel: Filters -->
    <div class="col-span-3">
      <div class="bg-white rounded-lg shadow p-4 mb-4">
        <h3 class="font-bold mb-4">Filter Users</h3>

        <!-- Company -->
        <div class="mb-4">
          <label>Company</label>
          <select
            [(ngModel)]="selectedCompanyId"
            (change)="onCompanySelect()"
            class="w-full border rounded p-2"
          >
            <option [ngValue]="null">All</option>
            <option *ngFor="let c of companies" [ngValue]="c.id">
              {{ c.name }}
            </option>
          </select>
        </div>

        <!-- Role -->
        <div class="mb-4">
          <label>Role</label>
          <select
            [(ngModel)]="selectedRoleId"
            (change)="onRoleSelect()"
            class="w-full border rounded p-2"
          >
            <option [ngValue]="null">All</option>
            <option *ngFor="let r of availableRoles" [ngValue]="r.id">
              {{ r.name }}
            </option>
          </select>
        </div>

        <!-- User -->
        <div class="mb-4">
          <label>User</label>
          <select
            [(ngModel)]="selectedUserId"
            (change)="onUserSelect()"
            class="w-full border rounded p-2"
          >
            <option [ngValue]="null">Select User</option>
            <option *ngFor="let u of availableUsers" [ngValue]="u.id">
              {{ u.name }}
            </option>
          </select>
        </div>

        <!-- Main Module -->
        <div class="mb-4">
          <label>Main Module</label>
          <select
            [(ngModel)]="selectedMainModule"
            (change)="onMainModuleSelect()"
            class="w-full border rounded p-2"
          >
            <option [ngValue]="null">Select Main Module</option>
            <option *ngFor="let m of availableMainModules" [ngValue]="m">
              {{ m.title }}
            </option>
          </select>
        </div>

        <!-- Sub Module -->
        <div class="mb-4">
          <label>Sub Module</label>
          <select
            [(ngModel)]="selectedSubModule"
            (change)="onSubModuleSelect()"
            class="w-full border rounded p-2"
          >
            <option [ngValue]="null">Select Sub Module</option>
            <option *ngFor="let s of availableSubModules" [ngValue]="s">
              {{ s.option }}
            </option>
          </select>
        </div>

        <!-- Nested Module -->
        <div class="mb-4">
          <label>Nested Module</label>
          <select
            [(ngModel)]="selectedNestedModule"
            (change)="onNestedModuleSelect()"
            class="w-full border rounded p-2"
          >
            <option [ngValue]="null">Select Nested Module</option>
            <option *ngFor="let n of availableNestedModules" [ngValue]="n">
              {{ n.option }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Right panel: Permissions -->
    <div class="col-span-9 grid grid-cols-1 gap-4">
      <div *ngIf="selectedUserId">
        <!-- Main Module Permissions -->
        <div *ngIf="selectedMainModule" class="rounded-lg shadow bg-white">
          <div
            class="p-3 text-white font-bold rounded-t-lg"
            [ngClass]="selectedMainModule.color"
          >
            {{ selectedMainModule.title }}
          </div>
          <div class="p-4">
            <!-- Main Permissions -->
            <div
              *ngFor="let perm of selectedMainModule.permissions"
              class="pb-2"
            >
              <div class="font-semibold mb-2">{{ perm.label }}</div>
              <div class="grid grid-cols-3 gap-2">
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.canread"
                    (change)="onPermissionChange('main')"
                  />
                  Read</label
                >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.canwrite"
                    (change)="onPermissionChange('main')"
                  />
                  Write</label
                >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.canput"
                    (change)="onPermissionChange('main')"
                  />
                  Put</label
                >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.candelete"
                    (change)="onPermissionChange('main')"
                  />
                  Delete</label
                >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.isvisible"
                    (change)="onPermissionChange('main')"
                  />
                  Visible</label
                >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.ishidden"
                    (change)="onPermissionChange('main')"
                  />
                  Hidden</label
                >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.isrestricted"
                    (change)="onPermissionChange('main')"
                  />
                  Restricted</label
                >
              </div>
            </div>

            <!-- Sub Module Permissions -->
            <div
              *ngIf="selectedSubModule"
              class="pl-4 border-l-2 border-gray-200 mt-4"
            >
              <div class="font-semibold mb-2">
                {{ selectedSubModule.option }}
              </div>
              <div
                *ngFor="let perm of selectedSubModule.permissions"
                class="grid grid-cols-3 gap-2"
              >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.canread"
                    (change)="onPermissionChange('sub')"
                  />
                  Read</label
                >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.canwrite"
                    (change)="onPermissionChange('sub')"
                  />
                  Write</label
                >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.canput"
                    (change)="onPermissionChange('sub')"
                  />
                  Put</label
                >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.candelete"
                    (change)="onPermissionChange('sub')"
                  />
                  Delete</label
                >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.isvisible"
                    (change)="onPermissionChange('sub')"
                  />
                  Visible</label
                >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.ishidden"
                    (change)="onPermissionChange('sub')"
                  />
                  Hidden</label
                >
                <label
                  ><input
                    type="checkbox"
                    [(ngModel)]="perm.isrestricted"
                    (change)="onPermissionChange('sub')"
                  />
                  Restricted</label
                >
              </div>

              <!-- Nested Module Permissions -->
              <div
                *ngIf="selectedNestedModule"
                class="pl-4 border-l-2 border-gray-300 mt-4"
              >
                <div class="font-semibold mb-2">
                  {{ selectedNestedModule.option }}
                </div>
                <div
                  *ngFor="let perm of selectedNestedModule.permissions"
                  class="grid grid-cols-3 gap-2"
                >
                  <label
                    ><input
                      type="checkbox"
                      [(ngModel)]="perm.canread"
                      (change)="onPermissionChange('nested')"
                    />
                    Read</label
                  >
                  <label
                    ><input
                      type="checkbox"
                      [(ngModel)]="perm.canwrite"
                      (change)="onPermissionChange('nested')"
                    />
                    Write</label
                  >
                  <label
                    ><input
                      type="checkbox"
                      [(ngModel)]="perm.canput"
                      (change)="onPermissionChange('nested')"
                    />
                    Put</label
                  >
                  <label
                    ><input
                      type="checkbox"
                      [(ngModel)]="perm.candelete"
                      (change)="onPermissionChange('nested')"
                    />
                    Delete</label
                  >
                  <label
                    ><input
                      type="checkbox"
                      [(ngModel)]="perm.isvisible"
                      (change)="onPermissionChange('nested')"
                    />
                    Visible</label
                  >
                  <label
                    ><input
                      type="checkbox"
                      [(ngModel)]="perm.ishidden"
                      (change)="onPermissionChange('nested')"
                    />
                    Hidden</label
                  >
                  <label
                    ><input
                      type="checkbox"
                      [(ngModel)]="perm.isrestricted"
                      (change)="onPermissionChange('nested')"
                    />
                    Restricted</label
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
